<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.odde.atddv2.mybatis.mapper.OrderMapper">
    <resultMap id="OrderResult" type="com.odde.atddv2.mybatis.entity.Order">
        <id property="id" column="id"/>
        <result property="code" column="code"/>
        <result property="productName" column="product_name"/>
        <result property="recipientName" column="recipient_name"/>
        <result property="recipientMobile" column="recipient_mobile"/>
        <result property="recipientAddress" column="recipient_address"/>
        <result property="deliverNo" column="deliver_no"/>
        <result property="status" column="status"/>
        <result property="total" column="total"/>
        <result property="deliveredAt" column="delivered_at"/>
    </resultMap>

    <resultMap id="OrderLineResult" type="com.odde.atddv2.mybatis.entity.OrderLine">
        <id property="id" column="id"/>
        <result property="itemName" column="item_name"/>
        <result property="price" column="price"/>
        <result property="quantity" column="quantity"/>
        <result property="orderId" column="order_id"/>
    </resultMap>

    <select id="findAll" resultMap="OrderResult">
        SELECT * FROM orders ORDER BY id
    </select>

    <select id="findAllLines" resultMap="OrderLineResult">
        SELECT * FROM order_lines
    </select>

    <insert id="insertOrder" parameterType="com.odde.atddv2.mybatis.entity.Order"
            useGeneratedKeys="true"
            keyProperty="id">
        INSERT INTO orders(code, product_name, recipient_name, recipient_mobile, recipient_address, deliver_no,
        status,
        total, delivered_at)
        VALUES(#{code}, #{productName}, #{recipientName}, #{recipientMobile}, #{recipientAddress}, #{deliverNo},
        #{status}, #{total}, #{deliveredAt})
    </insert>

    <insert id="insertOrderLine" parameterType="com.odde.atddv2.mybatis.entity.OrderLine"
            useGeneratedKeys="true"
            keyProperty="id">
        INSERT INTO order_lines(item_name, price, quantity, order_id)
        VALUES(#{itemName}, #{price}, #{quantity}, #{orderId})
    </insert>
</mapper>
